---
import { getCollection } from 'astro:content';

const allEvents = await getCollection('events');
const upcomingEvents = allEvents
  .filter(event => new Date(event.data.date) >= new Date())
  .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())
  .slice(0, 3);
---

{upcomingEvents.length > 0 ? (
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    {upcomingEvents.map((event) => {
      const eventDate = new Date(event.data.date);
      const formattedDate = eventDate.toLocaleDateString('fr-FR', {
        day: 'numeric',
        month: 'long',
        year: 'numeric',
      });
      
      return (
        <div class="p-6 rounded-xl glass-effect border border-border hover:border-accent hover:glow transition-all duration-300 transform hover:-translate-y-1">
          <div class="text-sm text-fg-muted mb-2 font-medium">{formattedDate}</div>
          <h3 class="text-xl font-semibold text-fg mb-3">{event.data.title}</h3>
          <div class="space-y-2 text-sm text-fg-muted mb-4">
            {event.data.type && (
              <div class="inline-block px-3 py-1 bg-accent/20 text-accent rounded-full text-xs font-medium">
                {event.data.type}
              </div>
            )}
            {event.data.city && <div class="flex items-center gap-2">ğŸ“ {event.data.city}</div>}
            {event.data.venue && <div class="flex items-center gap-2">ğŸ¢ {event.data.venue}</div>}
            {event.data.duration && <div class="flex items-center gap-2">â±ï¸ {event.data.duration}</div>}
            {event.data.level && <div class="flex items-center gap-2">ğŸ“Š {event.data.level}</div>}
            {event.data.price && <div class="flex items-center gap-2">ğŸ’° {event.data.price}</div>}
          </div>
          {event.data.cta_url && (
            <a 
              href={event.data.cta_url}
              class="inline-flex items-center gap-2 text-sm text-accent hover:underline font-medium group"
            >
              {event.data.cta_label || 'En savoir plus'}
              <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          )}
        </div>
      );
    })}
  </div>
) : (
  <div class="text-center py-12 text-fg-muted">
    <p class="mb-4 text-lg">Aucun Ã©vÃ©nement Ã  venir pour le moment.</p>
    <a href="/contact" class="text-accent hover:underline font-medium">Contactez-nous pour Ãªtre informÃ©Â·e</a>
  </div>
)}

